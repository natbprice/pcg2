---
title: "Running TVDiff Python Code from R"
author: "Nat Price"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{python}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

This package includes R code for the 'small' algorithm for Total Variation 
Regularized Differentiation in 1-dimension. Users wishing to run the 'large'
algorithm or more recent multidimensional algorithms may wish to use the 
reticulate package. The example below illustrates how to create a simple wrapper
function for the Python translations by Simone Sturniolo 
(https://github.com/stur86/tvregdiff).

```{r}
TVRegDiffPyWrap <- function(data,
                            iter,
                            alph,
                            u0,
                            scale = 'small',
                            ep = 1e-6,
                            dx,
                            plotflag = 0,
                            diagflag = 0,
                            tol = 1e-4,
                            maxit = 200) {
  

    # Get python code directory
    pyDir <- system.file("python-code", package = "tvdiff")
    if (pyDir == "") {
      stop("Could not find `python-code`. Try re-installing `tvdiff`.", call. = FALSE)
    }

    # Source python code
    reticulate::source_python(file.path(pyDir, "tvregdiff.py"), 
                              envir = environment(), 
                              convert = T)

    # Call python function
    u <- TVRegDiffPy(
      data = data,
      itern = as.integer(iter),
      alph = alph,
      scale = scale,
      ep = ep,
      dx = dx,
      plotflag = plotflag,
      diagflag = diagflag,
      tol = tol,
      maxit = maxit
    )

    return(u)
  }

```

